# Security NFR — Idea Catalog API

| ID     | Название                             | Описание                                                                 | Метрика/Порог                                   | Проверка (чем/где)                                       | Компонент       | Приоритет |
|--------|--------------------------------------|--------------------------------------------------------------------------|-------------------------------------------------|----------------------------------------------------------|-----------------|-----------|
| NFR-01 | Доступ к защищённым эндпойнтам       | Все административные операции требуют JWT с подписью RS256 и TTL 60 мин | 100% защищённых эндпойнтов проверяют JWT; TTL ≤ 3600 c | Контрактные тесты `tests/security/test_admin_access.py` (Sprint S1) + проверка переменных окружения в CI | auth            | High      |
| NFR-02 | Валидация вводимых данных            | Сервис принимает только данные, прошедшие схему Pydantic и доп. фильтры | 100% POST/PATCH эндпойнтов отклоняют payload вне схемы | Автотесты `pytest -q` (в т.ч. `tests/test_ideas.py`) + линтер `ruff` | api             | High      |
| NFR-03 | Ограничение частоты создания идей    | Пользователь не может создать >100 идей в минуту                         | ≤ 100 успешных POST `/ideas` на токен за 60 c   | Нагрузочный тест k6 `scripts/loadtest/ideas-rate-limit.js` в nightly pipeline | api-gateway     | Medium    |
| NFR-04 | Защита от дубликатов оценок          | Повторные оценки от одного пользователя блокируются                      | ≤ 1 активная оценка на пользователя и идею      | Интеграционный тест `tests/security/test_eval_dedup.py` (Sprint S2) | core-service    | Medium    |
| NFR-05 | Логирование подозрительных действий  | Повторные ошибки авторизации фиксируются в audit-логе                    | ≥ 95% событий 401/403 попадают в `security.log` | CI-скрипт `scripts/check_security_logs.py` + спринтовый аудит | observability   | Medium    |
| NFR-06 | Отчёт об уязвимостях зависимостей    | High/Critical уязвимости закрываются в течение недели                    | SLA исправления ≤ 7 дней с момента выявления    | weekly job с `pip-audit` + обязательное Github Issue с дедлайном | build-pipeline  | High      |
| NFR-07 | Управление секретами                 | Секреты хранятся только в Vault/ENV и ротируются каждые 30 дней          | TTL секрета ≤ 30 дней                            | CI-скрипт `scripts/secrets_ttl.py` + отчёт Vault | platform        | Medium    |
| NFR-08 | Шифрование данных резервных копий    | Бэкапы приложений и БД шифруются AES-256                                  | 100% бэкапов с AES-256, ключ в KMS               | Отчёт KMS + чек-лист релиза по бэкапам                     | infra           | Low       |
